
{{ $currentNode := . }}
{{ $showvisitedlinks := .Site.Params.showVisitedLinks }}

{{range .Site.Sections.ByWeight.Reverse}}
  {{ if eq .Type  "documentation" }}
    <ul class="doctree">
      {{ template "section-tree-nav" dict "sect" . "currentnode" $currentNode "showvisitedlinks" $showvisitedlinks }}
    </ul>
  {{ end }}
{{end}}


<!-- templates -->
{{ define "section-tree-nav" }}

{{ $showvisitedlinks := .showvisitedlinks }}
{{ $currentNode := .currentnode }}
{{ with .sect }}
  {{ if .IsSection }}
    {{ safeHTML .Params.head }}

    {{ .Scratch.Set "li_class" "liSingle" }}
    {{ $numberOfPages := (add (len .Pages) (len .Sections)) }}
    {{ if ne $numberOfPages 0 }}
      {{ if or (.IsAncestor $currentNode) (.Params.alwaysopen) }}
        {{ .Scratch.Set "li_class" "liOpened" }}
      {{ else }}
        {{ .Scratch.Set "li_class" "liClosed" }}
      {{ end }}
    {{ end }}
    {{ $liClass := (.Scratch.Get "li_class") }}

    <li data-nav-id="{{.URL}}" class="dd-item 
        {{if .IsAncestor $currentNode }}parent{{end}}
        {{if eq .UniqueID $currentNode.UniqueID}}active{{end}}
        {{if .Params.alwaysopen}}parent{{end}}
        {{ $liClass }}
        ">

      <a href="{{ .RelPermalink}}">
        <span>{{ safeHTML .Params.Pre }}{{ .Title }}{{ safeHTML .Params.Post }}</span>
      </a>

      {{ if ne $numberOfPages 0 }}
        <ul>
          {{ .Scratch.Set "pages" .Pages }}
          {{ if .Sections}}
            {{ .Scratch.Set "pages" (.Pages | union .Sections) }}
          {{ end }}
          {{ $pages := (.Scratch.Get "pages") }}
          
        {{ if eq .Site.Params.ordersectionsby "title" }}
          {{ range $pages.ByTitle }}
            {{ if and .Params.hidden (not $.showhidden) }}
            {{ else }}
              {{ template "section-tree-nav" dict "sect" . "currentnode" $currentNode "showvisitedlinks" $showvisitedlinks }}
            {{ end }}
          {{ end }}
        {{ else }}
          {{ range $pages.ByWeight }}
            {{ if and .Params.hidden (not $.showhidden) }}
            {{ else }}
            {{ template "section-tree-nav" dict "sect" . "currentnode" $currentNode "showvisitedlinks" $showvisitedlinks }}
            {{ end }}
          {{ end }}
        {{ end }}
        </ul>
      {{ end }}
    </li>

  {{ else }}
    {{ if not .Params.Hidden }}
      <li data-nav-id="{{.URL}}" class="dd-item {{if eq .UniqueID $currentNode.UniqueID}}active{{end}} liSingle">
<!--         <i class="fa-li fa fa-caret-right doctree-icon"></i>
 -->        <a href="{{ .RelPermalink }}">
        <span>{{safeHTML .Params.Pre}}{{.Title}}{{safeHTML .Params.Post}}</span> 
        </a></li>
     {{ end }}
  {{ end }}
{{ end }}

{{ end }}
