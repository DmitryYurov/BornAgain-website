
{{- $currentNode := . }}

{{- range .Site.Sections.ByWeight.Reverse}}
  {{- if eq .Type  "documentation" }}
    <ul class="doctree">
      {{- template "section-tree-nav" dict "sect" . "currentnode" $currentNode }}
    </ul>
  {{- end}}
{{- end}}

<!-- templates -->
{{- define "section-tree-nav" }}

{{- $currentNode := .currentnode }}
{{- with .sect}}
  {{- if .IsSection}}
    {{- safeHTML .Params.head}}

    <li data-nav-id="{{.URL}}" class="dd-item
        {{- if .IsAncestor $currentNode}} parent{{end}}
        {{- if eq .URL $currentNode.URL}} active{{end}}
        {{- if .Params.alwaysopen}} alwaysopen{{end -}}
        ">
        
      {{- $numberOfPages := (add (len .Pages) (len .Sections)) }}

      {{- if ne $numberOfPages 0 }}
        {{- if or (.IsAncestor $currentNode) (.Params.alwaysopen) }}
          <i class="fa liOpened li-item-icon"></i>
        {{- else -}}
          <i class="fa liClosed li-item-icon"></i>
        {{- end}}
      {{- end}}

      <a href="{{ .RelPermalink}}">
        <span>{{ safeHTML .Params.Pre }}{{ .Title }}{{ safeHTML .Params.Post }}</span>
      </a>

      {{- if ne $numberOfPages 0 }}
        <ul>
          {{- .Scratch.Set "pages" .Pages }}
          {{- if .Sections}}
            {{- .Scratch.Set "pages" (.Pages | union .Sections) }}
          {{- end}}          
          {{- $pages := (.Scratch.Get "pages") }}
          
          {{- range $pages.ByWeight.Reverse }}
            
            {{- if and .Params.hidden (not $.showhidden) }}
            {{- else}}
            {{- template "section-tree-nav" dict "sect" . "currentnode" $currentNode }}
            {{- end}}            
            
          {{- end}}

        </ul>
      {{- end}}
    </li>

  {{- else}}
    {{- if not .Params.Hidden }}
      <li data-nav-id="{{.URL}}" class="dd-item {{- if eq .URL $currentNode.URL}} active{{end -}}">
        <i class="fa liSingle li-item-icon"></i>
        <a href="{{ .RelPermalink }}">
        <span>{{safeHTML .Params.Pre}}{{.Title}}{{safeHTML .Params.Post}}</span> 
        </a></li>
     {{- end}}
  {{- end}}
{{- end}}

{{- end}}
