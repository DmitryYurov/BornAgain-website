
{{ $currentNode := . }}

{{range .Site.Sections.ByWeight.Reverse}}
  {{ if eq .Type  "documentation" }}
    <ul class="doctree">
      {{ template "section-tree-nav" dict "sect" . "currentnode" $currentNode }}
    </ul>
  {{ end }}
{{end}}


<!-- templates -->
{{ define "section-tree-nav" }}

{{ $currentNode := .currentnode }}
{{ with .sect }}
  {{ if .IsSection }}
    {{ safeHTML .Params.head }}

    <li data-nav-id="{{.URL}}" class="dd-item 
        {{if .IsAncestor $currentNode }}parent{{end}}
        {{if eq .UniqueID $currentNode.UniqueID}}active{{end}}
        {{if .Params.alwaysopen}}parent{{end}}
        ">

      {{ $numberOfPages := (add (len .Pages) (len .Sections)) }}
      {{ .Scratch.Set "li_icon" "liSingle" }}

      {{ if ne $numberOfPages 0 }}
        {{ if or (.IsAncestor $currentNode) (.Params.alwaysopen) }}
          {{ .Scratch.Set "li_icon" "liOpened" }}
        {{ else }}
          {{ .Scratch.Set "li_icon" "liClosed" }}
        {{ end }}
      {{ end }}
      {{ $liIcon := (.Scratch.Get "li_icon") }}

      <i class="fa {{$liIcon}} li-item-icon"></i>

      <a href="{{ .RelPermalink}}">
        <span>{{ safeHTML .Params.Pre }}{{ .Title }}{{ safeHTML .Params.Post }}</span>
      </a>

      {{ if ne $numberOfPages 0 }}
        <ul>
          {{ .Scratch.Set "pages" .Pages }}
          {{ if .Sections}}
            {{ .Scratch.Set "pages" (.Pages | union .Sections) }}
          {{ end }}
          {{ $pages := (.Scratch.Get "pages") }}
          
        {{ if eq .Site.Params.ordersectionsby "title" }}
          {{ range $pages.ByTitle }}
            {{ if and .Params.hidden (not $.showhidden) }}
            {{ else }}
              {{ template "section-tree-nav" dict "sect" . "currentnode" $currentNode}}
            {{ end }}
          {{ end }}
        {{ else }}
          {{ range $pages.ByWeight }}
            {{ if and .Params.hidden (not $.showhidden) }}
            {{ else }}
            {{ template "section-tree-nav" dict "sect" . "currentnode" $currentNode }}
            {{ end }}
          {{ end }}
        {{ end }}
        </ul>
      {{ end }}
    </li>

  {{ else }}
    {{ if not .Params.Hidden }}
      <li data-nav-id="{{.URL}}" class="dd-item {{if eq .UniqueID $currentNode.UniqueID}}active{{end}}">
        <i class="fa liSingle li-item-icon"></i>
        <a href="{{ .RelPermalink }}">
        <span>{{safeHTML .Params.Pre}}{{.Title}}{{safeHTML .Params.Post}}</span> 
        </a></li>
     {{ end }}
  {{ end }}
{{ end }}

{{ end }}
